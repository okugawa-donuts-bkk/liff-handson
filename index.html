<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Hands-on</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .profile-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }
        button {
            background: #06C755;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 8px 4px;
        }
        button:disabled {
            background: #ccc;
        }
        #log {
            background: #f5f5f5;
            padding: 12px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üéØ LIFF Hands-on</h1>
    
    <div class="card">
        <h3>Status</h3>
        <p>LIFF Init: <span id="liff-status">‚è≥</span></p>
        <p>Login: <span id="login-status">‚è≥</span></p>
        <p>Context: <span id="context">-</span></p>
    </div>

    <div class="card" id="profile-card" style="display:none;">
        <h3>Profile</h3>
        <img id="profile-img" class="profile-img" src="" alt="">
        <p><strong id="profile-name"></strong></p>
        <p id="profile-userid" style="font-size:12px; color:#666;"></p>
    </div>

    <div class="card">
        <h3>Actions</h3>
        <button id="btn-login" onclick="login()">Login</button>
        <button id="btn-logout" onclick="logout()">Logout</button>
        <button id="btn-send" onclick="sendMessage()">Send Message</button>
        <button onclick="closeWindow()">Close LIFF</button>
    </div>

    <div class="card">
        <h3>Log</h3>
        <div id="log"></div>
    </div>

    <script>
        // ‚ö†Ô∏è „Åì„Åì„Å´„ÅÇ„Å™„Åü„ÅÆLIFF ID„ÇíÂÖ•„Çå„Çã
        const LIFF_ID = "2008821815-lUW2FsbY";

        function log(msg) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.textContent = `[${time}] ${msg}\n` + logEl.textContent;
            console.log(msg);
        }

        async function initLiff() {
            try {
                log("LIFF initializing...");
                await liff.init({ liffId: LIFF_ID });
                
                document.getElementById('liff-status').textContent = "‚úÖ OK";
                document.getElementById('context').textContent = liff.getContext()?.type || "external";
                log(`LIFF initialized. OS: ${liff.getOS()}`);

                if (liff.isLoggedIn()) {
                    document.getElementById('login-status').textContent = "‚úÖ Logged in";
                    document.getElementById('btn-login').disabled = true;
                    await showProfile();
                } else {
                    document.getElementById('login-status').textContent = "‚ùå Not logged in";
                    document.getElementById('btn-logout').disabled = true;
                }
            } catch (error) {
                document.getElementById('liff-status').textContent = "‚ùå Error";
                log(`Error: ${error.message}`);
            }
        }

        function login() {
            log("Starting login...");
            liff.login();
        }

        function logout() {
            log("Logging out...");
            liff.logout();
            location.reload();
        }

        async function showProfile() {
            try {
                const profile = await liff.getProfile();
                log(`Profile loaded: ${profile.displayName}`);
                
                document.getElementById('profile-card').style.display = 'block';
                document.getElementById('profile-img').src = profile.pictureUrl;
                document.getElementById('profile-name').textContent = profile.displayName;
                document.getElementById('profile-userid').textContent = `ID: ${profile.userId}`;
            } catch (error) {
                log(`Profile error: ${error.message}`);
            }
        }

        async function sendMessage() {
            if (!liff.isInClient()) {
                log("‚ö†Ô∏è sendMessages only works in LINE app");
                alert("„Åì„ÅÆÊ©üËÉΩ„ÅØLINE„Ç¢„Éó„É™ÂÜÖ„Åß„ÅÆ„ÅøÂãï‰Ωú„Åó„Åæ„Åô");
                return;
            }
            
            try {
                await liff.sendMessages([{
                    type: "text",
                    text: "üéâ LIFF„Åã„Çâ„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°ÊàêÂäüÔºÅ"
                }]);
                log("Message sent!");
            } catch (error) {
                log(`Send error: ${error.message}`);
            }
        }

        function closeWindow() {
            if (liff.isInClient()) {
                liff.closeWindow();
            } else {
                log("‚ö†Ô∏è closeWindow only works in LINE app");
            }
        }

        // Ëµ∑Âãï
        initLiff();
    </script>
</body>
</html>

